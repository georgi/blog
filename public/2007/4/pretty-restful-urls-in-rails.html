<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <title>Matthias Georgi - Pretty RESTful URLs in Rails</title>
    <meta http-equiv="Content-Language" content="English" />
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
    <link rel="alternate" type="application/rss+xml" title="RSS" href="../../ruby.rss" />
    <link rel="stylesheet" media="screen" href="../../stylesheets/reset.css"></link>
<link rel="stylesheet" media="screen" href="../../stylesheets/grid.css"></link>
<link rel="stylesheet" media="screen" href="../../stylesheets/typography.css"></link>
<link rel="stylesheet" media="screen" href="../../stylesheets/style.css"></link>
<link rel="stylesheet" media="screen" href="../../stylesheets/highlight/default.css"></link>
    <script type="text/javascript" src="../../javascripts/Core.js"></script>
<script type="text/javascript" src="../../javascripts/functional.js"></script>
<script type="text/javascript" src="../../javascripts/to-function.js"></script>
<script type="text/javascript" src="../../javascripts/jquery.js"></script>
<script type="text/javascript" src="../../javascripts/jquery-form.js"></script>
<script type="text/javascript" src="../../javascripts/template.js"></script>
<script type="text/javascript" src="../../javascripts/prettyDate.js"></script>
<script type="text/javascript" src="../../javascripts/swfobject.js"></script>
<script type="text/javascript" src="../../javascripts/default.js"></script>
    <script>var Blog = { root: '../../', guid: '9dba3ad0-5d6c-012b-b53a-001a92975b89' };</script>
  </head>
  <body>
    <div class="container">

      <div id="header" class="column span-20 last">
	<h1><a href="../../index.html">Matthias Georgi</a></h1>
	<h2>Webdev, Gamedev, Interaction Design</h2>
      </div>

      <div id="navi"  class="column span-20 last">
	<a class="" href="../../index.html">Home</a>
	
	  <a class="active" href="../../categories/ruby.html">Ruby</a>
	
	  <a class="" href="../../categories/emacs.html">Emacs</a>
	
	<a class="" href="../../about.html">About</a>
      </div>

      
	<div id="header-text" class="column span-20 last">
	  <h1>Ruby</h1>
	</div>
      

      <div class="content column span-15"> 
	<div class="article">
  <div class="date">
    April 10, 2007
  </div>
  <h2>Pretty RESTful URLs in Rails</h2>  
  <p>Since Release 1.2 Rails knows to generate <em>RESTful</em> routes. Each
resource is identified by an <em>URI</em>, which looks like <code>/users/123</code> . It
would be nice to have more readable URLs, which include the name of
the user: <code>/users/matthias-georgi</code>. This is a short tutorial on making
your urls pretty while retaining the REST approach.</p>

<p>Assuming that you already have an user model, we add following line to
our <code>config/routes.rb</code>:</p>

<pre><code>map.resources :users
</code></pre>

<p>You may now run the <code>scaffold_resource</code> generator in case you don't have
any <code>UsersController</code> yet. In order to remember the <em>permalink</em> for each
user, we store it in a column named <code>permalink</code> in the users
table. Before we save an user record, we have to infer a url-safe
permalink for the user name. We do this by:</p>

<pre><code>def before_save
  self.permalink = name.downcase.gsub(/[^a-z0-9]+/i, '-') if permalink.blank?
end
</code></pre>

<p>Each character, which is not an <em>alphanumeric</em> will be replaced by a
dash. This is only done, if the permalink is not set already. So we
have a way for users to set their permalink manually. To avoid
duplicate permalinks, we <em>validate</em> the uniqeness of the permalink:</p>

<pre><code>validates_uniqeness_of :permalink
</code></pre>

<p>What happens now, if we browse to a user url like
<code>/users/matthias-georgi</code> ? Rails raises an exception, telling us that it
cannot find an record with the id <code>matthias-georgi</code>. We'll fix now our
controller to look for the permalink and not the id of the user. Just
replace each call to <code>User.find(params[:id])</code> with
<code>User.find_by_permalink(params[:id])</code>. Also we have to ensure, that our
user routes will be generated correctly. Therefore we overwrite the
<code>to_param</code> method:</p>

<pre><code>def to_param
  permalink
end
</code></pre>

<p>The effect of this little change is, that <code>user_url(a_user)</code> generates
the right url. <em>Nested resources</em> and <em>pretty urls</em> can get tricky and for
now I won't touch this topic. Remember that <em>changing</em> the permalink may
be problematic as links to the old url will get invalid. Nevertheless
have fun experimenting with pretty urls and the new wonderful world of
REST.</p>

  <h3>Comments</h3>

  <div class="comments-loading" style="display:none">
    <img src="../../images/loading.gif"></img>
    Loading Comments...
  </div>

  <div class="comments">  
    <div id="comments-template">
      <div class="comment">
	<div class="_ top">
	  <a class="_" href="{website}">{name}</a> said
	  <a class="_" title="{time}"></a>:
	</div>
	<div class="text"></div>
      </div>
    </div>
  </div>

  <hr/>  

  <div class="comment-form-loading" style="display:none">
    <img src="../../images/loading.gif"></img>
    Posting Comment...
  </div>

  <div class="comment-form">
    <h4>Leave a comment</h4>
    <form>
      <input type="hidden" name="guid" value="9dba3ad0-5d6c-012b-b53a-001a92975b89"/>
      <p>
	<label>Name</label><br/>
	<input type="text" name="name" size="40"/>
      </p>
      <p>
	<label>Website</label><br/>
	<input type="text" name="website"  size="40"/>
      </p>
      <p>
	<label>Comment</label><br/>
	<textarea name="text" cols="60" rows="10"></textarea>
      </p>
      <p>
	<input type="submit" value="Post comment"/>
      </p>
    </form>
  </div>
</div>

<script type="text/javascript" src="../../javascripts/comments.js"></script>



      </div>

      <div class="right column span-5 last"> 
	<h4>Subscribe</h4>
	<h4>About</h4>
	<div class="about">
	  <strong>Matthias Georgi</strong> lives in
	  <em>Darmstadt, Germany</em> and works as a freelance
	  software developer.
	  <a href="../../about.html">read more</a>
	</div>
	<h4>Archives</h4>
	<ul>
	  
	    <li><a href="../../2007/4/index.html">April 2007</a></li> 
	  
	    <li><a href="../../2007/5/index.html">May 2007</a></li> 
	  
	    <li><a href="../../2008/9/index.html">September 2008</a></li> 
	  
	</ul>
	<h4>My Projects</h4>
	<ul>
	  <li>
	    <a href="http://github.com/georgi/shinmun/tree/master">
	      Shinmun, a small blog engine
	    </a>
	  </li>
	</ul>
	<h4>My Music</h4>
	<ul>
	  <li>
	    <a href="http://www.p-ersag.com">
	      Planet Ersag
	    </a>
	  </li>
	</ul>
      </div>
    </div>

    <script type="text/javascript" src="../../javascripts/highlight.js"></script>

    <script type="text/javascript">
      hljs.initHighlightingOnLoad('ruby', 'html', 'css', 'php', 'javascript', 'sql', 'lisp', 'xml', 'java');
    </script>

  </body>
</html>
