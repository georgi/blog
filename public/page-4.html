<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN"
    "http://www.w3.org/TR/html4/strict.dtd">

<html>
    <head>
        <title>
            Matthias Georgi
        </title>
        <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
        <link rel="alternate" type="application/atom+xml" href="/atom.xml" title="Atom 1.0">
        <link rel="stylesheet" media="screen" type="text/css" href="/style.css">
        <link rel="stylesheet" href="/zenburn.css">
        <script src="/highlight.pack.js">
            
        </script>
        <script>
            hljs.initHighlightingOnLoad();
        </script>
    </head>
    <body>
        <div class="container">
            <h2 id="header">
                <a href="/">
                    Matthias Georgi
                </a>
            </h2>
            <div class="content">
                <div class="article">
                    <h1>
                        <a href="/2008/9/quick-guide-for-passenger-on-ubuntu-hardy.html">
                            Quick Guide for Passenger on Ubuntu Hardy
                        </a>
                    </h1>
                    <p>This is a short guide for installing <a href="http://www.modrails.com/">Phusion Passenger</a> on Ubuntu
Hardy. This includes the installation of Ruby 1.8.6, Apache 2.2.8, 
MySQL 5.0.51a, Git 1.5.4 and Rails 2.1.1.</p>

<h3>Essential Build Tools</h3>

<p>First we need to install the compiler toolchain (make, gcc and libc).</p>

<pre><code>$ apt-get install build-essential
</code></pre>

<h3>Git</h3>

<p>This guide is based on Git, so we install the git package:</p>

<pre><code>$ apt-get install git-core
</code></pre>

<p>If you want to host a git repository on this machine, initialize a new
repository:</p>

<pre><code>$ mkdir /var/git
$ mkdir /var/git/myapp
$ cd /var/git/myapp
$ git --bare init
</code></pre>

<p>Now you can push your application code from your local machine to your
repository:</p>

<pre><code>$ cd ~/myapp
$ git remote add origin ssh://myserver.com/var/git/myapp
$ git push origin master
</code></pre>

<h3>Ruby</h3>

<p>We are going to install Ruby and all the essential ruby libraries.</p>

<pre><code>$ apt-get install ruby ruby1.8-dev rubygems irb ri rdoc rake libruby libruby-extras
</code></pre>

<h3>Gem Executable Path</h3>

<p>Strangely the <em>rubygems</em> package does not setup the path for
executables, so we add the following line to <code>/etc/profile</code>.</p>

<pre><code>export PATH=/var/lib/gems/1.8/bin:$PATH
</code></pre>

<p>To immediately use the new executable path, we source the profile file:</p>

<pre><code>$ . /etc/profile
</code></pre>

<h3>Apache</h3>

<p>This is just a basic Apache install. We need the devlopment files for compiling passenger:</p>

<pre><code>$ apt-get install apache2 apache2-prefork-dev
</code></pre>

<h3>MySQL</h3>

<p>I use MySQL, so I needed to install the server and client packages and
the Ruby gem, which compiles a native extension:</p>

<pre><code>$ apt-get install mysql-server mysql-client
$ gem install mysql
</code></pre>

<h3>Phusion Passenger</h3>

<p>This is now the actual Passenger install, which consists of installing
a gem and compiling the Apache module:</p>

<pre><code>$ gem install passenger
$ passenger-install-apache2-module
</code></pre>

<h3>Apache configuration</h3>

<p>The compilation of the Passenger Apache
module finished with an instruction for your httpd.conf. Depending on
you passenger version, you will get something like this, which you add
to your <code>/etc/apache2/httpd.conf</code>:</p>

<pre><code>LoadModule passenger_module /var/lib/gems/1.8/gems/passenger-2.0.3/ext/apache2/mod_passenger.so
PassengerRoot /var/lib/gems/1.8/gems/passenger-2.0.3
PassengerRuby /usr/bin/ruby1.8
</code></pre>

<p>Additionally you probably want to enable <em>mod_rewrite</em>, which is
needed for Rails:</p>

<pre><code>$ a2enmod rewrite
</code></pre>

<h3>Installing your Rails app</h3>

<p>We create a app folder in <code>/var/www</code> and checkout the source from our
git repository:</p>

<pre><code>$ cd /var/www
$ mkdir myapp
$ cd myapp
$ git init
$ git remote add origin /var/git/myapp
$ git pull origin master
</code></pre>

<h4>Installing Rails</h4>

<p>We don&#39;t install Rails as Gem, because your application should be
pinned to a specific Rails version. Git submodules allow you to embed
a foreign repository in your source tree. </p>

<p>We are now going to link the Rails repository to <code>vendor/rails</code> and
checking out Version 2.1.1, finally we commit the submodule link to
our repository:</p>

<pre><code>$ cd /var/www/myapp/
$ git submodule add git://github.com/rails/rails.git vendor/rails
$ cd vendor/rails
$ git checkout v2.1.1
$ cd ../..
$ git commit -m &#39;linked rails as submodule&#39;
</code></pre>

<p>Probably you need to setup your database:</p>

<pre><code>$ mysaladmin create myapp_production
$ mysaladmin create myapp_development
$ mysaladmin create myapp_test
$ rake db:migrate
</code></pre>

<p>Now your Rails app should be able to run as a Webrick Server:</p>

<pre><code>$ ./script/server
</code></pre>

<h3>Virtual host</h3>

<p>Adding a virtual host for your rails application is now super easy
thanks to Passenger. Create a file named
<code>/etc/apache2/sites-available/myapp</code>:</p>

<pre><code>&lt;VirtualHost *:80&gt;
    ServerName myserver.com
    DocumentRoot /var/www/myapp/public
&lt;/VirtualHost&gt;
</code></pre>

<p>Now we disable the default site and add our new virtual host:</p>

<pre><code>$ a2dissite default
$ a2ensite myapp
</code></pre>

<p>After restarting Apache your Rails application should run on Apache:</p>

<pre><code>$ /etc/init.d/apache2 restart
</code></pre>

<h3>User authentication</h3>

<p>In case your Rails app is not meant to be seen on public, I recommend
protecting it with HTTP Authentication.</p>

<p>Create a password file:</p>

<pre><code>htpasswd2 /var/www/myapp/config/auth myusername
</code></pre>

<p>And add this to your virtual host configuration (Inside the
VirtualHost section):</p>

<pre><code>&lt;Location /&gt;
    AuthType Basic
    AuthName &quot;My App&quot;
    AuthUserFile /var/www/myapp/config/auth
    Require valid-user
&lt;/Location&gt;
</code></pre>

<h3>Conclusion</h3>

<p>Phusion Passenger simplifies the Installation of Rails applications
significantly. I don&#39;t have to worry about <code>mod_proxy</code>,
<code>mod_proxy_balancer</code>, <code>mongrel</code> and <code>mongrel_cluster</code> or even
FastCGI. This is <strong>definitely simpler</strong>.</p>

<p>I have to mention, that Rails is just one option for your Ruby
application. Setting up any other Ruby framework should be possible
through the support of the <a href="http://rack.rubyforge.org/">Rack</a> interface. </p>

<p>I really hope, that the specification of using one <em>rackup file</em> and
one <em>public folder</em> will settle down as a standard for Ruby web
applications, so that hosting companies will focus on supporting this
standard and ruby developers don&#39;t need to worry about finding support
for their favorite web frameworks.</p>

                </div>
                <div class="article">
                    <h1>
                        <a href="/2008/9/patroon-a-javascript-template-engine.html">
                            Patroon - a Javascript Template Engine
                        </a>
                    </h1>
                    <p>Patroon is a template engine written in Javascript in about 100 lines
of code. It takes existing DOM nodes annotated with CSS classes and
expand a data object according to simple rules. Additionally you may
use traditional string interpolation inside attribute values and text
nodes.</p>

<p><strong>
Patroon has its own <a href="/patroon">project page</a> now!
Please look for current information there.
</strong></p>

<h3>Example</h3>

<p>Comments in this blog are stored as a list of JSON objects, I wrote about it <a href="http://www.matthias-georgi.de/commenting-system-with-lightweight-json-store.html">here</a>. So think about a data object like this:</p>

<pre><code>var data = { 
  comment: [{
    date: &quot;2008-09-07 12:28:33&quot;, 
    name: &quot;David Beckham&quot;,
    website: &quot;beckham.com&quot;,
    text: &quot;I watched the euro finals on tv...&quot; 
  }, { 
    date: &quot;2008-09-07 14:28:33&quot;, 
    name: &quot;Tuncay&quot;,
    website: &quot;&quot;,
    text: &quot;Me too&quot;
  }]
};
</code></pre>

<p>This data will be expanded with help of following template:</p>

<pre><code>&lt;div class=&quot;comments&quot;&gt;  
  &lt;div id=&quot;comments-template&quot;&gt;
    &lt;div class=&quot;comment&quot;&gt;
      &lt;div class=&quot;_ top&quot;&gt;
        &lt;a class=&quot;_&quot; href=&quot;{website}&quot;&gt;{name}&lt;/a&gt; said
        &lt;a class=&quot;_&quot; title=&quot;{time}&quot;&gt;&lt;/a&gt;:
      &lt;/div&gt;
      &lt;div class=&quot;text&quot;&gt;&lt;/div&gt;
    &lt;/div&gt;   
  &lt;/div&gt;
&lt;/div&gt;
</code></pre>

<p>The javascript to actually execute this template looks like this:</p>

<pre><code>// The comments template will be removed from the DOM!
var template = new Template(&#39;comments-template&#39;);

// template will result in a new DOM node
var result = template.expand(data);

// insert the resulting node into the comments container
var container = document.getElementsByClassName(&#39;comments&#39;)[0];
container.appendChild(result);
</code></pre>

<p>Using jQuery the code gets a bit cleaner:</p>

<pre><code>// The comments template will be removed from the DOM!
var template = new Template(&#39;comments-template&#39;);

// Expand the template into the comments section
$(&#39;.comments&#39;).expand(template, data);
</code></pre>

<h3>Basic Rules</h3>

<p>There are 5 basic rules:</p>

<ul>
<li><p>Strings and Numbers are inserted by innerHTML to the current node.</p></li>
<li><p>Arrays repeat the current node and process its elements recursively in same scope.</p></li>
<li><p>Objects trigger a class name lookup by property name. The value of each property is expanded recursively in new scope.</p></li>
<li><p>Code will be evaluated for text surounded with braces (Works also for attributes).</p></li>
<li><p>Processing child nodes will be triggered for nodes with a class attribute starting with <code>_</code>.</p></li>
</ul>

<p>I admit the last point is a bit quirky, but processing all child nodes per default is too expensive and too unpredictable. Maybe I will find a better way, but I don’t mind inserting these extra <code>_</code> class names.</p>

<h3>Evaluation</h3>

<p>So speaking of the example data, this would mean following algorithm:</p>

<ul>
<li><p>Find the first node with a class name of comment.</p></li>
<li><p>Repeat this node two times and recursively process the first and second comment.</p></li>
<li><p>Descend into the node with class <code>top</code>.</p></li>
<li><p>Descend into the first link node.</p></li>
<li><p>Evaluate the code found in the <em>href</em> attribute and in the text.</p></li>
<li><p>Descend into the second link node.</p></li>
<li><p>Evaluate the code found in the <em>title</em> attribute.</p></li>
<li><p>Find the first node with the class <code>text</code>.</p></li>
<li><p>Insert the the text of the comment into the found node.</p></li>
</ul>

<p>Note that we are dealing with two scopes here: the global scope and the comment scope. The global scope just contains a name <em>comment</em> and the comment scope contains the names <code>date</code>, <code>name</code>, <code>website</code> and <code>text</code>.</p>

<h3>Download</h3>

<p>Download the script at my <a href="http://github.com/georgi/patroon/tree/master">github repository</a>.</p>

                </div>
                <div class="article">
                    <h1>
                        <a href="/2008/9/patroon-a-javascript-template-engine-part-2.html">
                            Patroon - a Javascript Template Engine (Part 2)
                        </a>
                    </h1>
                    <p>This post is an update to my <a href="http://www.matthias-georgi.de/2008/9/patroon-a-javascript-template-engine.html">initial post</a>. Patroon has been
improved and is now easier to use and uses a better algorithm
internally.</p>

<p>Patroon is a template engine written in Javascript in about 130 lines
of code. It takes existing DOM nodes annotated with class names and
expand a data object according to simple rules. Additionally you may
use traditional string interpolation inside attribute values and text
nodes.</p>

<h3>The Data</h3>

<p>Comments in this blog are stored as a list of JSON objects, I wrote
about it <a href="http://www.matthias-georgi.de/2008/9/commenting-system-with-lightweight-json-store.html">here</a>. So think about a data object like this:</p>

<pre><code>var data = { 
  comment: [{
    time: &quot;2008-09-07 12:28:33&quot;, 
    name: &quot;David Beckham&quot;,
    website: &quot;beckham.com&quot;,
    text: &quot;I watched the euro finals on tv...&quot; 
  }, { 
    time: &quot;2008-09-07 14:28:33&quot;, 
    name: &quot;Tuncay&quot;,
    website: &quot;&quot;,
    text: &quot;Me too&quot;
  }]
};
</code></pre>

<h3>The Template</h3>

<p>This data will be expanded with help of following template:</p>

<pre><code>&lt;div class=&quot;comments&quot;&gt;  
  &lt;div id=&quot;comments-template&quot;&gt;
    &lt;div class=&quot;comment&quot;&gt;
      &lt;div class=&quot;top&quot;&gt;
        {website.length &gt; 0 ? linkTo(name, website) : name} said
        &lt;a title=&quot;{time}&quot;&gt;&lt;/a&gt;:
      &lt;/div&gt;
      &lt;div class=&quot;text&quot;&gt;
        {text}
      &lt;/div&gt;
    &lt;/div&gt;   
  &lt;/div&gt;
&lt;/div&gt;
</code></pre>

<h3>Usage</h3>

<p>The javascript to actually execute this template looks like this:</p>

<pre><code>// The comments template will be removed from the DOM!
var template = new Template(&#39;comments-template&#39;);

// Expand the template into the comments section
$(&#39;.comments&#39;).expand(template, data);
</code></pre>

<p>If you don&#39;t want to use jQuery, please look at the end of this article.</p>

<h3>Output</h3>

<p>The given example renders following output:</p>

<pre><code>&lt;div class=&quot;comments&quot;&gt;  
  &lt;div id=&quot;comments-template&quot;&gt;
    &lt;div class=&quot;comment&quot;&gt;
      &lt;div class=&quot;top&quot;&gt;
        &lt;a href=&quot;http://backham.com&quot;&gt;David Beckham&lt;/a&gt; said
        &lt;a title=&quot;2008-09-07 12:28:33&quot;&gt;2 hours ago&lt;/a&gt;
      &lt;/div&gt;
      &lt;div class=&quot;text&quot;&gt;
        I watched the euro finals on tv...
      &lt;/div&gt;
    &lt;/div&gt;   
    &lt;div class=&quot;comment&quot;&gt;
      &lt;div class=&quot;top&quot;&gt;
        Tuncay said
        &lt;a title=&quot;2008-09-07 14:28:33&quot;&gt;1 minute ago&lt;/a&gt;
      &lt;/div&gt;
      &lt;div class=&quot;text&quot;&gt;
        Me too
      &lt;/div&gt;
    &lt;/div&gt;   
  &lt;/div&gt;
&lt;/div&gt;
</code></pre>

<h3>Basic Rules</h3>

<p>There are 3 basic rules regarding the evaluation:</p>

<ul>
<li><p>Each found class name of a node will be looked up in the current
data object. If found, the node will be processed in the new scope.
Example: the class name <code>comment</code> instructs to lookup the name
<code>comment</code> in the data object, which contains the comment array.</p></li>
<li><p>Arrays repeat the current node and process its elements recursively.</p></li>
<li><p>Code will be evaluated for text surrounded with braces (works also
for attributes). The evaluation takes place in the scope of the
current data object, which is in the example a comment object. So
the snippet <code>&lt;a title=&quot;{time}&quot;&gt;</code> will lookup the time in the comment
object and insert into the title attribute.</p></li>
</ul>

<h3>Helper</h3>

<p>Code snippets inside the template will be executed within the scope of
a Helper object. If you want to extend it, just add your functions to
<code>Template.Helper</code>. At the moment it defines only one function:</p>

<pre><code>Template.Helper = {

    linkTo: function(text, url) {
        if (url.indexOf(&#39;http://&#39;) == -1 &amp;&amp; url[0] != &#39;/&#39; &amp;&amp; url[0] != &#39;#&#39;) {
            url = &#39;http://&#39; + url;
        }
        return &#39;&lt;a href=&quot;&#39; + url +&#39;&quot;&gt;&#39; + text + &#39;&lt;/a&gt;&#39;;
    }

};
</code></pre>

<h3>Examples</h3>

<ul>
<li><a href="http://www.matthias-georgi.de/2008/9/using-javascript-templates-for-a-delicious-sidebar.html">a Delicious Sidebar</a>, which renders a <em>JSON</em> feed with the help
of Patroon.</li>
</ul>

<h3>Download</h3>

<p>Download the script at my <a href="http://github.com/georgi/patroon/tree/master">github repository</a>.</p>

<h3>Related Work</h3>

<p>There are some other libraries for javascript templating, which are
related to <strong>Patroon</strong>:</p>

<ul>
<li><a href="http://beebole.com/pure/">PURE</a></li>
<li><a href="http://jsrepeater.devprog.com/">jsRepeater</a></li>
<li><a href="http://code.google.com/p/trimpath/wiki/JavaScriptTemplates">TrimPath</a></li>
<li><a href="http://embeddedjs.com/">EmbeddedJS</a></li>
</ul>

<p>Patroon is probably the smallest templating solution around and
consists only of 130 lines of code.</p>

<h3>Appendix</h3>

<p>Without jQuery template expansion is a bit verbose:</p>

<pre><code>@@javascript

// The comments template will be removed from the DOM!
var template = new Template(&#39;comments-template&#39;);

// template will result in a new DOM node
var result = template.expand(data);

// insert the resulting node into the comments container
var container = document.getElementsByClassName(&#39;comments&#39;)[0];
container.appendChild(result);
</code></pre>

                </div>
                <a rel="next" href="page-5.html">
                    Next entries
                </a>
            </div>
        </div>
    </body>
</html>
