<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <title>Matthias Georgi - Emacs Completions</title>
    <meta http-equiv="Content-Language" content="English" />
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
    <link rel="alternate" type="application/rss+xml" title="RSS" href="../../emacs.rss" />
    <link rel="stylesheet" media="screen" href="../../stylesheets/reset.css"></link>
<link rel="stylesheet" media="screen" href="../../stylesheets/grid.css"></link>
<link rel="stylesheet" media="screen" href="../../stylesheets/typography.css"></link>
<link rel="stylesheet" media="screen" href="../../stylesheets/style.css"></link>
<link rel="stylesheet" media="screen" href="../../stylesheets/highlight/default.css"></link>
    <script type="text/javascript" src="../../javascripts/Core.js"></script>
<script type="text/javascript" src="../../javascripts/functional.js"></script>
<script type="text/javascript" src="../../javascripts/to-function.js"></script>
<script type="text/javascript" src="../../javascripts/jquery.js"></script>
<script type="text/javascript" src="../../javascripts/jquery-form.js"></script>
<script type="text/javascript" src="../../javascripts/template.js"></script>
<script type="text/javascript" src="../../javascripts/prettyDate.js"></script>
<script type="text/javascript" src="../../javascripts/swfobject.js"></script>
<script type="text/javascript" src="../../javascripts/default.js"></script>
    <script>var Blog = { root: '../../', guid: 'ffb31770-5dc1-012b-b53b-001a92975b89' };</script>
  </head>
  <body>
    <div class="container">

      <div id="header" class="column span-20 last">
	<h1><a href="../../index.html">Matthias Georgi</a></h1>
	<h2>Webdev, Gamedev, Interaction Design</h2>
      </div>

      <div id="navi"  class="column span-20 last">
	<a class="" href="../../index.html">Home</a>
	
	  <a class="" href="../../categories/ruby.html">Ruby</a>
	
	  <a class="active" href="../../categories/emacs.html">Emacs</a>
	
	<a class="" href="../../about.html">About</a>
      </div>

      
	<div id="header-text" class="column span-20 last">
	  <h1>Emacs</h1>
	</div>
      

      <div class="content column span-15"> 
	<div class="article">
  <div class="date">
    September 4, 2008
  </div>
  <h2>Emacs Completions</h2>  
  <p>One of the most important features of a text editor is the completing
of text inside a buffer. There a lots of packages for Emacs, which
provide this feature in many different ways. I will show you, what I
use to improve my life as coder.</p>

<div id="emacs-completion" class="swfobject"></div>

<h4>Multifunctional tab key</h4>

<p>Most of the time the tab key in Emacs is bound to the indentation
command, which will indent the current line. So if you want to use the
tab key for other things, you need some kind of multiplexer, which
tries to figure out, what is the right thing to do in each situation.</p>

<p>So I copied the indent-and-complete from the <a href="http://dima-exe.ru/rails-on-emacs" title="Emacs Rails package">emacs-rails package</a>:</p>

<pre><code>(require 'hippie-exp)
(require 'snippet)

(defun indent-and-complete ()
  "Indent line and complete"
  (interactive)

  (cond
   ((and (boundp 'snippet) snippet)
    (snippet-next-field))

   ((looking-at "\_&gt;")
    (hippie-expand nil))

   ((indent-for-tab-command))))
</code></pre>

<p>The function <code>indent-and-complete</code> does one of the following actions:</p>

<ul>
<li>if a snippet is active, it jumps to the next field</li>
<li>if we are at a word boundary, it tries to complete with <code>hippie-expand</code></li>
<li>otherwise it indents the current line</li>
</ul>

<h4>HTML mode initialization</h4>

<p>Well, this function alone will not change your editor behaviour. For
activating our tab function, we need to bind the tab key.</p>

<p>Additionally we want to setup <code>hippie-expand</code>, an expansion package,
which will try to expand the word before the cursor in a configurable
way. <code>hippie-expand-try-functions-list</code> is a variable, which defines a
list of functions, which should be called for completion.</p>

<p>Let's have a look at my <code>html-mode</code> initialization function. It will configure
the completion behaviour of hippie-expand an bind the tab key to <code>indent-and-complete</code>.</p>

<pre><code>;; ********************************************************************************
;; HTML Mode
;;
(add-to-list 'auto-mode-alist '("\.html\'" . html-mode))

(defun html-mode-on-init ()
  (set (make-local-variable 'hippie-expand-try-functions-list)
       '(try-expand-abbrev
         try-expand-dabbrev))
  (define-key html-mode-map (kbd "&lt;tab&gt;") 'indent-and-complete))

(add-hook 'html-mode-hook 'html-mode-on-init)
</code></pre>

<p>There a two functions, which will be asked to complete the current word:</p>

<ul>
<li><p><code>try-expand-abbrev</code>: Expands the current word by looking into the
list of defined abbreviations. So called abbrevs are just shortcuts
in Emacs. So if you type <code>li</code> and hit the tab key it will be
expanded to <code>&lt;li&gt;&lt;/li&gt;</code>.</p></li>
<li><p><code>try-expand-dabbrev</code>: Dynamic abbreviation is a pragmatic method for
completing words. Emacs will look for words with the same beginning
and use them for completion. Hitting multiple times the tab key will
give you different completions, as you may know from the unix shell.</p></li>
</ul>

<h4>Defining your snippets</h4>

<p>Now if you want to use snippets for your <code>html-mode</code>, you have to
define a abbrev-table with your desired snippets. </p>

<pre><code>(define-abbrev-table 'html-mode-abbrev-table ())

(snippet-with-abbrev-table 'html-mode-abbrev-table 
 ("h1"      . "&lt;h1&gt;$.&lt;/h1&gt;")
 ("h2"      . "&lt;h2&gt;$.&lt;/h2&gt;")
 ("h3"      . "&lt;h3&gt;$.&lt;/h3&gt;")
 ("h4"      . "&lt;h3&gt;$.&lt;/h4&gt;")
 ("h5"      . "&lt;h3&gt;$.&lt;/h5&gt;")
 ("h6"      . "&lt;h6&gt;$.&lt;/h6&gt;")
 ("div"     . "&lt;div&gt;$.&lt;/div&gt;")
 ("divc"    . "&lt;div class=\"$${class}\"&gt;$.&lt;/div&gt;")
 ("span"    . "&lt;span&gt;$.&lt;/span&gt;")
 ("spans"   . "&lt;span style=\"$${style}\"&gt;$.&lt;/span&gt;")
 ("form"    . "&lt;form action=\"$${action}\" method=\"$${post}\"&gt;$.&lt;/form&gt;")
 ("input"   . "&lt;input type=\"$${text}\" name=\"$${name}\" value=\"$${value}\"/&gt;")
 ("a"       . "&lt;a href=\"$${href}\"&gt;$.&lt;/a&gt;")
 ("br"      . "&lt;br/&gt;$.")
 ("ul"      . "&lt;ul&gt;$.&lt;/ul&gt;")
 ("ol"      . "&lt;ul&gt;$.&lt;/ul&gt;")
 ("li"      . "&lt;li&gt;$.&lt;/li&gt;")
 ("tab"     . "&lt;table&gt;$.&lt;/table&gt;")
 ("tr"      . "&lt;tr&gt;$.&lt;/tr&gt;")
 ("td"      . "&lt;td&gt;$.&lt;/td&gt;")
 ("th"      . "&lt;th&gt;$.&lt;/th&gt;")
 ("str"     . "&lt;strong&gt;$.&lt;/strong&gt;")
 ("em"      . "&lt;em&gt;$.&lt;/em&gt;")
 ("meta"    . "&lt;meta name=\"$${name}\" content=\"$${content}\"/&gt;")
 ("style"   . "&lt;style type=\"text/css\"&gt;$.&lt;/style&gt;")
 ("script"  . "&lt;script type=\"text/javascript\"&gt;$.&lt;/script&gt;")
 ("scripts" . "&lt;script src=\"$${src}\" type=\"text/javascript\"&gt;$.&lt;/script&gt;")
 ("img"     . "&lt;img src=\"$.\"/&gt;")
 ("link"    . "&lt;link href=\"$${href}\" media=\"screen\" rel=\"stylesheet\" type=\"text/css\"/&gt;"))
</code></pre>

<p>Great. If you put all the code in your .emacs file, you should be able
to use your tab key for completions. In our case we defined snippets
for the <code>html-mode</code> and activated <code>hippie-expand</code> to use abbrevs and
dynamic abbreviation. There is much more stuff I will show you next
time, like customizations for other language modes like <em>Ruby</em> and
<em>Javascript</em>.</p>

  <h3>Comments</h3>

  <div class="comments-loading" style="display:none">
    <img src="../../images/loading.gif"></img>
    Loading Comments...
  </div>

  <div class="comments">  
    <div id="comments-template">
      <div class="comment">
	<div class="_ top">
	  <a class="_" href="{website}">{name}</a> said
	  <a class="_" title="{time}"></a>:
	</div>
	<div class="text"></div>
      </div>
    </div>
  </div>

  <hr/>  

  <div class="comment-form-loading" style="display:none">
    <img src="../../images/loading.gif"></img>
    Posting Comment...
  </div>

  <div class="comment-form">
    <h4>Leave a comment</h4>
    <form>
      <input type="hidden" name="guid" value="ffb31770-5dc1-012b-b53b-001a92975b89"/>
      <p>
	<label>Name</label><br/>
	<input type="text" name="name" size="40"/>
      </p>
      <p>
	<label>Website</label><br/>
	<input type="text" name="website"  size="40"/>
      </p>
      <p>
	<label>Comment</label><br/>
	<textarea name="text" cols="60" rows="10"></textarea>
      </p>
      <p>
	<input type="submit" value="Post comment"/>
      </p>
    </form>
  </div>
</div>

<script type="text/javascript" src="../../javascripts/comments.js"></script>



      </div>

      <div class="right column span-5 last"> 
	<h4>Subscribe</h4>
	<h4>About</h4>
	<div class="about">
	  <strong>Matthias Georgi</strong> lives in
	  <em>Darmstadt, Germany</em> and works as a freelance
	  software developer.
	  <a href="../../about.html">read more</a>
	</div>
	<h4>Archives</h4>
	<ul>
	  
	    <li><a href="../../2007/4/index.html">April 2007</a></li> 
	  
	    <li><a href="../../2007/5/index.html">May 2007</a></li> 
	  
	    <li><a href="../../2008/9/index.html">September 2008</a></li> 
	  
	</ul>
	<h4>My Projects</h4>
	<ul>
	  <li>
	    <a href="http://github.com/georgi/shinmun/tree/master">
	      Shinmun, a small blog engine
	    </a>
	  </li>
	</ul>
	<h4>My Music</h4>
	<ul>
	  <li>
	    <a href="http://www.p-ersag.com">
	      Planet Ersag
	    </a>
	  </li>
	</ul>
      </div>
    </div>

    <script type="text/javascript" src="../../javascripts/highlight.js"></script>

    <script type="text/javascript">
      hljs.initHighlightingOnLoad('ruby', 'html', 'css', 'php', 'javascript', 'sql', 'lisp', 'xml', 'java');
    </script>

  </body>
</html>
