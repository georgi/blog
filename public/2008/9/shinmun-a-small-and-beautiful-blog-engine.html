<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <title>Matthias Georgi - Shinmun, a small and beautiful blog engine</title>
    <meta http-equiv="Content-Language" content="English" />
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
    <link rel="alternate" type="application/rss+xml" title="RSS" href="../../ruby.rss" />
    <link rel="stylesheet" media="screen" href="../../stylesheets/reset.css"></link>
<link rel="stylesheet" media="screen" href="../../stylesheets/grid.css"></link>
<link rel="stylesheet" media="screen" href="../../stylesheets/typography.css"></link>
<link rel="stylesheet" media="screen" href="../../stylesheets/style.css"></link>
<link rel="stylesheet" media="screen" href="../../stylesheets/highlight/default.css"></link>
    <script type="text/javascript" src="../../javascripts/Core.js"></script>
<script type="text/javascript" src="../../javascripts/functional.js"></script>
<script type="text/javascript" src="../../javascripts/to-function.js"></script>
<script type="text/javascript" src="../../javascripts/jquery.js"></script>
<script type="text/javascript" src="../../javascripts/jquery-form.js"></script>
<script type="text/javascript" src="../../javascripts/template.js"></script>
<script type="text/javascript" src="../../javascripts/prettyDate.js"></script>
<script type="text/javascript" src="../../javascripts/swfobject.js"></script>
<script type="text/javascript" src="../../javascripts/default.js"></script>
    <script>var Blog = { root: '../../', guid: '7ad04f10-5dd6-012b-b53c-001a92975b89' };</script>
  </head>
  <body>
    <div class="container">

      <div id="header" class="column span-20 last">
	<h1><a href="../../index.html">Matthias Georgi</a></h1>
	<h2>Webdev, Gamedev, Interaction Design</h2>
      </div>

      <div id="navi"  class="column span-20 last">
	<a class="" href="../../index.html">Home</a>
	
	  <a class="active" href="../../categories/ruby.html">Ruby</a>
	
	  <a class="" href="../../categories/emacs.html">Emacs</a>
	
	<a class="" href="../../about.html">About</a>
      </div>

      
	<div id="header-text" class="column span-20 last">
	  <h1>Ruby</h1>
	</div>
      

      <div class="content column span-15"> 
	<div class="article">
  <div class="date">
    September 5, 2008
  </div>
  <h2>Shinmun, a small and beautiful blog engine</h2>  
  <p>Small is beautiful. This is especially true for software, as you can
tailor the code exactly to your needs. I tried several times to build
a blog engine, but was always dissatisfied by the
complexity. Deploying is a problem too. I don't want to run a fat
rails process for a small blog like this. The solution was a finally a
tiny script, which renders text files to static web pages. The biggest
advantage is, that I can edit my articles and templates in Emacs and
easily extend the software in Ruby.</p>

<h4>Directory layout</h4>

<p>The layout is as following:</p>

<ul>
<li><p>The blog description, base url and the category list is in a file
called <code>blog.yml</code></p></li>
<li><p>Posts should be put into folders by date. <code>my-article.md</code> is in the
folder 9 (September) of the year 2008. Posts are distinguished from
pages by having a date attribute.</p></li>
<li><p>Pages can be put anywhere, like <code>about.md</code></p></li>
<li><p>The output directory is called public. Static files should be put
into the directories <code>images</code>, <code>stylesheets</code>, <code>javascripts</code>.</p></li>
<li><p>Category pages will be rendered into the <code>categories</code> folder. A category
page will display recent entries for one category.</p></li>
<li><p>An index page will be generated for recent posts.</p></li>
</ul>

<p>Following is an example folder tree:</p>

<pre><code>+ posts  
  + blog.yml
  + about.md
  * 2007
    + 2008
      + 9
        + my-article.md
+ public
  + index.html
  + about.html
  + categories
    + emacs.html
    + ruby.html
  + 2007   
  + 2008
    + 9
      + my-article.html
  + images
  + stylesheest
  + javascripts
</code></pre>

<h4>Layout and Templates</h4>

<p>Layout and templates are rendered by good old ERB. This is the
probably the simplest solution, but ERB templates are still powerful,
they can execute arbitrary ruby code and call helper methods.</p>

<p>There are also some helper methods, which have the same interface like
rails helpers. The template class just needs a few methods to be useful:</p>

<pre><code># This class renders an ERB template for a set of attributes, which
# are accessible as instance variables.
class Template

  attr_reader :root

  # Initialize this template with an ERB instance.
  def initialize(erb)
    @erb = erb
  end

  # Set instance variable for this template.
  def set_variables(vars)
    for name, value in vars
      instance_variable_set("@#{name}", value)
    end
  end

  # Render this template.
  def render
    @erb.result(binding)
  end

  # Render a hash as attributes for a HTML tag. 
  def attributes(attributes)
    attributes.map { |k, v| %Q{#{k}="#{v}"} }.join(' ')
  end

  # Render a HTML tag with given name. 
  # The last argument specifies the attributes of the tag.
  # The second argument may be the content of the tag.
  def tag(name, *args)
    text, attributes = args.first.is_a?(Hash) ? [nil, args.first] : args
    "&lt;#{name} #{attributes(attributes)}&gt;#{text}&lt;/#{name}&gt;"
  end    

  # Render stylesheet link tags with fixed url.
  def stylesheet_link_tag(*names)
    names.map { |name|
      tag :link, :href =&gt; "#{root}stylesheets/#{name}.css", :rel =&gt; 'stylesheet', :media =&gt; 'screen'
    }.join("\n")
  end

end
</code></pre>

<h4>Meta data</h4>

<p>Each document has a header section and a body section, which are
separated by a newline. The header section is just a YAML document and
the body section consists of an markdown document. This is also
extremly simple, but just works. An example is probably the best way
to understand this:</p>

<pre>
--- 
category: Ruby
guid: 7ad04f10-5dd6-012b-b53c-001a92975b89
title: BlueCloth, a Markdown library
tags: ruby, bluecloth, markdown
date: 2008-09-05

This is the summary, which is by definition the first paragraph of the
article. The summary shows up in category listings or the index listing.
</pre>  

<p>The blog engine will assign a GUID to the post, the first time it will
be rendered. This GUID should never change, as it will be you used for
identifying posts for comments.</p>

<h4>RSS Feeds</h4>

<p>A blog without feeds is worthless. But a feed is nothing more than an
ERB template file. Some of the variables used here, have been read
from the meta file:</p>

<pre><code>&lt;?xml version="1.0" encoding="utf-8"?&gt;
&lt;rss version="2.0"&gt; 
  &lt;channel&gt;
    &lt;title&gt;&lt;%= @category ? @blog_title + ' - ' + @category : @blog_title %&gt;&lt;/title&gt;
    &lt;link&gt;&lt;%= @blog_url %&gt;&lt;/link&gt;
    &lt;description&gt;&lt;%= @category ? 'Category ' + @category : @blog_description %&gt;&lt;/description&gt;
    &lt;language&gt;&lt;%= @blog_language %&gt;&lt;/language&gt;
    &lt;copyright&gt;&lt;%= @blog_author %&gt;&lt;/copyright&gt;
    &lt;pubDate&gt;&lt;%= rfc822 Time.now %&gt;&lt;/pubDate&gt;
    &lt;% for post in @posts %&gt;
      &lt;item&gt;
        &lt;title&gt;&lt;%= post.title %&gt;&lt;/title&gt;
        &lt;description&gt;&lt;%= post.text_summary %&gt;&lt;/description&gt;
        &lt;link&gt;&lt;%= post.link %&gt;&lt;/link&gt;
        &lt;author&gt;&lt;%= @blog_author %&gt;&lt;/author&gt;
        &lt;guid&gt;&lt;%= post.guid %&gt;&lt;/guid&gt;
        &lt;pubDate&gt;&lt;%= rfc822 post.date %&gt;&lt;/pubDate&gt;
      &lt;/item&gt;
    &lt;% end %&gt;
  &lt;/channel&gt; 
&lt;/rss&gt;
</code></pre>

<h4>JSON store in PHP</h4>

<p>As I am not willing to build up a whole Rails stack for a single blog,
I was looking for a simple storage for comments. I really like the
JSON format. It works seamlessly with ExtJS, jQuery and other
Javascript libraries and can be serialized and deserialized from
almost any language.</p>

<p>PHP is not the most elegant language (in fact not even close), but has
the tremendous advantage to be ubiquitous. Next time I will write
something about nifty comment forms in javascript (powered by jQuery)
and a simple JSON store.</p>

  <h3>Comments</h3>

  <div class="comments-loading" style="display:none">
    <img src="../../images/loading.gif"></img>
    Loading Comments...
  </div>

  <div class="comments">  
    <div id="comments-template">
      <div class="comment">
	<div class="_ top">
	  <a class="_" href="{website}">{name}</a> said
	  <a class="_" title="{time}"></a>:
	</div>
	<div class="text"></div>
      </div>
    </div>
  </div>

  <hr/>  

  <div class="comment-form-loading" style="display:none">
    <img src="../../images/loading.gif"></img>
    Posting Comment...
  </div>

  <div class="comment-form">
    <h4>Leave a comment</h4>
    <form>
      <input type="hidden" name="guid" value="7ad04f10-5dd6-012b-b53c-001a92975b89"/>
      <p>
	<label>Name</label><br/>
	<input type="text" name="name" size="40"/>
      </p>
      <p>
	<label>Website</label><br/>
	<input type="text" name="website"  size="40"/>
      </p>
      <p>
	<label>Comment</label><br/>
	<textarea name="text" cols="60" rows="10"></textarea>
      </p>
      <p>
	<input type="submit" value="Post comment"/>
      </p>
    </form>
  </div>
</div>

<script type="text/javascript" src="../../javascripts/comments.js"></script>



      </div>

      <div class="right column span-5 last"> 
	<h4>Subscribe</h4>
	<h4>About</h4>
	<div class="about">
	  <strong>Matthias Georgi</strong> lives in
	  <em>Darmstadt, Germany</em> and works as a freelance
	  software developer.
	  <a href="../../about.html">read more</a>
	</div>
	<h4>Archives</h4>
	<ul>
	  
	    <li><a href="../../2007/4/index.html">April 2007</a></li> 
	  
	    <li><a href="../../2007/5/index.html">May 2007</a></li> 
	  
	    <li><a href="../../2008/9/index.html">September 2008</a></li> 
	  
	</ul>
	<h4>My Projects</h4>
	<ul>
	  <li>
	    <a href="http://github.com/georgi/shinmun/tree/master">
	      Shinmun, a small blog engine
	    </a>
	  </li>
	</ul>
	<h4>My Music</h4>
	<ul>
	  <li>
	    <a href="http://www.p-ersag.com">
	      Planet Ersag
	    </a>
	  </li>
	</ul>
      </div>
    </div>

    <script type="text/javascript" src="../../javascripts/highlight.js"></script>

    <script type="text/javascript">
      hljs.initHighlightingOnLoad('ruby', 'html', 'css', 'php', 'javascript', 'sql', 'lisp', 'xml', 'java');
    </script>

  </body>
</html>
