<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <title>Matthias Georgi - My small and beatiful blog engine</title>
    <meta http-equiv="Content-Language" content="English" />
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
    <link rel="alternate" type="application/rss+xml" title="RSS" href="../../ruby.rss" />
    <link href="../../stylesheets/reset.css" rel="stylesheet" media="screen"></link>
<link href="../../stylesheets/grid.css" rel="stylesheet" media="screen"></link>
<link href="../../stylesheets/typography.css" rel="stylesheet" media="screen"></link>
<link href="../../stylesheets/style.css" rel="stylesheet" media="screen"></link>
<link href="../../stylesheets/highlight/default.css" rel="stylesheet" media="screen"></link>
    <script type="text/javascript" src="../../javascripts/Core.js"></script>
<script type="text/javascript" src="../../javascripts/functional.js"></script>
<script type="text/javascript" src="../../javascripts/to-function.js"></script>
<script type="text/javascript" src="../../javascripts/jquery.js"></script>
<script type="text/javascript" src="../../javascripts/jquery-form.js"></script>
<script type="text/javascript" src="../../javascripts/template.js"></script>
<script type="text/javascript" src="../../javascripts/prettyDate.js"></script>
<script type="text/javascript" src="../../javascripts/swfobject.js"></script>
<script type="text/javascript" src="../../javascripts/default.js"></script>
    <script>var Blog = { root: '../../', guid: '7ad04f10-5dd6-012b-b53c-001a92975b89' };</script>
  </head>
  <body>
    <div class="container">

      <div id="header" class="column span-20 last">
	<h1><a href="../../index.html">Matthias Georgi</a></h1>
	<h2>Webdev, Gamedev, Interaction Design</h2>
      </div>

      <div id="navi"  class="column span-20 last">
	<a class="" href="../../index.html">Home</a>
	
	  <a class="active" href="../../categories/ruby.html">Ruby</a>
	
	  <a class="" href="../../categories/emacs.html">Emacs</a>
	
	<a class="" href="../../about.html">About</a>
      </div>

      
	<div id="header-text" class="column span-20 last">
	  <h1>Ruby</h1>
	</div>
      

      <div class="content column span-15"> 
	<div class="article">
  <div class="date">
    September 5, 2008
  </div>
  <h2>My small and beatiful blog engine</h2>  
  <p>Small is beautiful. This is especially true for software, as you can
tailor the code exactly to your needs. I tried several times to build
a blog engine, but was always dissatisfied by the complexity of such a
project. Deploying is a problem too. I don't want to run a fat rails
process for a small blog like this. The solution was a tiny script,
which renders text files to static web pages. The biggest advantage
is, that I can edit my articles and templates in Emacs and easily
extend the software in Ruby.</p>

<h2>Directory layout</h2>

<p>The layout is simple:</p>

<ul>
<li><p>The blog description, base url and the category list is in a file
called <code>blog.yml</code></p></li>
<li><p>Posts should be put into folders by date. <code>my-article.md</code> is in the
folder 9 (September) of the year 2008.</p></li>
<li><p>Pages can be put anywhere, like <code>about.md</code></p></li>
<li><p>The output directory is called public. Static files should be put
into the directories <code>images</code>, <code>stylesheets</code>, <code>javascripts</code>.</p></li>
<li><p>Category pages will be rendered into the <code>categories</code> folder. A category
page will display recent entries for one category.</p></li>
<li><p>An index page will be generated for recent posts.</p></li>
</ul>

<p>Following is an example folder tree:</p>

<ul>
<li>posts<br/>
<ul>
<li>blog.yml</li>
<li>about.md</li>
<li>2007</li>
<li>2008</li>
<li>9
<ul>
<li>my-article.md</li>
</ul></li>
</ul></li>
<li>public
<ul>
<li>index.html</li>
<li>about.html</li>
<li>categories</li>
<li>emacs.html</li>
<li>ruby.html</li>
<li>2007   </li>
<li>2008</li>
<li>9
<ul>
<li>my-article.html</li>
</ul></li>
<li>images</li>
<li>stylesheest</li>
<li>javascripts</li>
</ul></li>
</ul>

<h2>Layout and Templates</h2>

<p>Layout and templates are rendered by good old ERB. This is the
probably the simplest solution, but ERB templates are still powerful,
they can execute arbitrary ruby code and call helper methods.</p>

<p>There are some helper methods, which I borrowed from rails. They do
almost the same, implemented in a few lines. Have a look, this is all
I need for my templates to render this blog:</p>

<pre><code>#
# This class renders an ERB template for a set of attributes, which
# are accessible as instance variables.
#
class Template

  attr_reader :root

  #
  # Initialize this template with an ERB instance.
  #
  def initialize(erb)
    @erb = erb
  end

  #
  # Set instance variable for this template.
  #
  def set_variables(vars)
    for name, value in vars
      instance_variable_set("@#{name}", value)
    end
  end

  #
  # Render this template.
  #
  def render
    @erb.result(binding)
  end

  #
  # Render a hash as attributes for a HTML tag. 
  #
  def attributes(attributes)
    attributes.map { |k, v| %Q{#{k}="#{v}"} }.join(' ')
  end

  #
  # Render a HTML tag with given name. 
  # The last argument specifies the attributes of the tag.
  # The second argument may be the content of the tag.
  #
  def tag(name, *args)
    text, attributes = args.first.is_a?(Hash) ? [nil, args.first] : args
    "&lt;#{name} #{attributes(attributes)}&gt;#{text}&lt;/#{name}&gt;"
  end

  # 
  # Render a stylesheet link tag with fixed url.
  #
  def stylesheet_link_tag(*names)
    names.map { |name|
      tag :link, :href =&gt; "#{root}stylesheets/#{name}.css", :rel =&gt; 'stylesheet', :media =&gt; 'screen'
    }.join("\n")
  end

  # 
  # Render a javascript tag with fixed url.
  #
  def javascript_tag(*names)
    names.map { |name|
      tag :script, :src =&gt; "#{root}javascripts/#{name}.js", :language =&gt; 'javacript'
    }.join("\n")
  end

  # 
  # Render an image tag with fixed url.
  #
  def image_tag(src, options = {})
    tag :img, options.merge(:src =&gt; root + 'images/' + src)
  end

  # 
  # Render a link with fixed url.
  #
  def link_to(text, path, options = {})
    tag :a, text, options.merge(:href =&gt; root + path + '.html')
  end

  # 
  # Render a link for the navigation bar. If the text of the link
  # matches the @header variable, the css class will be set to acitve.
  #
  def navi_link(text, path)
    link_to text, path, :class =&gt; (text == @header) ? 'active' : nil
  end

  # 
  # Render a link to a post with fixed url.
  #
  def post_link(post)
    link_to post.title, post.path
  end

  # 
  # Render a link to an archive page.
  #
  def month_link(year, month)
    link_to "#{Date::MONTHNAMES[month]} #{year}", "#{year}/#{month}/index"
  end

  #
  # Render a date or time in a nice human readable format.
  #
  def date(time)
    "%s %d, %d" % [Date::MONTHNAMES[time.month], time.day, time.year]
  end

  #
  # Render a date or time in rfc822 format. This will be used for rss rendering.
  #
  def rfc822(time)
    time.strftime("%a, %d %b %Y %H:%M:%S %z")
  end

end
</code></pre>

  <h3>Comments</h3>

  <div class="comments-loading" style="display:none">
    <img src="../../images/loading.gif"></img>
    Loading Comments...
  </div>

  <div class="comments">  
    <div id="comments-template">
      <div class="comment">
	<div class="_ top">
	  <a class="_" href="{website}">{name}</a> said
	  <a class="_" title="{time}"></a>:
	</div>
	<div class="text"></div>
      </div>
    </div>
  </div>

  <hr/>  

  <div class="comment-form-loading" style="display:none">
    <img src="../../images/loading.gif"></img>
    Posting Comment...
  </div>

  <div class="comment-form">
    <h4>Leave a comment</h4>
    <form>
      <input type="hidden" name="guid" value="7ad04f10-5dd6-012b-b53c-001a92975b89"/>
      <p>
	<label>Name</label><br/>
	<input type="text" name="name" size="40"/>
      </p>
      <p>
	<label>Website</label><br/>
	<input type="text" name="website"  size="40"/>
      </p>
      <p>
	<label>Comment</label><br/>
	<textarea name="text" cols="60" rows="10"></textarea>
      </p>
      <p>
	<input type="submit" value="Post comment"/>
      </p>
    </form>
  </div>
</div>

<script type="text/javascript" src="../../javascripts/comments.js"></script>



      </div>

      <div class="right column span-5 last"> 
	<h4>Subscribe</h4>
	<h4>About</h4>
	<div class="about">
	  <strong>Matthias Georgi</strong> lives in
	  <em>Darmstadt, Germany</em> and works as a freelance
	  software developer.
	  <a href="../../about.html">read more</a>
	</div>
	<h4>Archives</h4>
	<ul>
	  
	    <li><a href="../../2007/4/index.html">April 2007</a></li> 
	  
	    <li><a href="../../2007/5/index.html">May 2007</a></li> 
	  
	    <li><a href="../../2008/9/index.html">September 2008</a></li> 
	  
	</ul>
      </div>
    </div>

    <script type="text/javascript" src="../../javascripts/highlight.js"></script>

    <script type="text/javascript">
      hljs.initHighlightingOnLoad('ruby', 'html', 'css', 'php', 'javascript', 'sql', 'lisp', 'xml', 'java');
    </script>

  </body>
</html>
