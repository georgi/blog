<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <title>Matthias Georgi - Patroon - a Javascript Template Engine</title>
    <meta http-equiv="Content-Language" content="English" />
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
    <link rel="alternate" type="application/rss+xml" title="RSS" href="http://feeds.feedburner.com/matthias-georgi" />
    <link rel="stylesheet" href="../../stylesheets/all.css?1221133113" media="screen"></link>
<link rel="stylesheet" href="../../stylesheets/style.css?1220965122" media="screen"></link>
    <script>var Blog = { root: '../../', guid: 'dbbec5c0-6094-012b-f5dd-001a92975b89' };</script>
  </head>
  <body>
    <div class="container">

      <div id="header" class="column span-20 last">
	<h1><a href="../../index.html">Matthias Georgi</a></h1>
	<h2>Webdev, Gamedev, Interaction Design</h2>
      </div>

      <div id="navi"  class="column span-20 last">
	<ul>
	  <li><a class="" href="../../index.html">Home</a></li>
	  
	    <li><a class="" href="../../categories/ruby.html">Ruby</a></li>
	  
	    <li><a class="active" href="../../categories/javascript.html">Javascript</a></li>
	  
	    <li><a class="" href="../../categories/emacs.html">Emacs</a></li>
	  
	  <li><a class="" href="../../about.html">About</a></li>
	</ul>
      </div>

      
	<div id="header-text" class="column span-20 last">
	  <h1>Javascript</h1>
	</div>
      

      <div class="content column span-15"> 
	<div class="article">

  <div class="date">
    September 9, 2008
  </div>

  <h2>Patroon - a Javascript Template Engine</h2>  

  <p>Patroon is a template engine written in Javascript in about 100 lines
of code. It takes existing DOM nodes annotated with CSS classes and
expand a data object according to simple rules. Additionally you may
use traditional string interpolation inside attribute values and text
nodes.</p>

<h3>Example</h3>

<p>Comments in this blog are stored as a list of JSON objects, I wrote about it <a href="commenting-system-with-lightweight-json-store.html">here</a>. So think about a data object like this:</p>

<pre><code>var data = { 
  comment: [{
    date: "2008-09-07 12:28:33", 
    name: "David Beckham",
    website: "beckham.com",
    text: "I watched the euro finals on tv..." 
  }, { 
    date: "2008-09-07 14:28:33", 
    name: "Tuncay",
    website: "",
    text: "Me too"
  }]
};
</code></pre>

<p>This data will be expanded with help of following template:</p>

<pre><code>    &lt;div class="comments"&gt;  
      &lt;div id="comments-template"&gt;
        &lt;div class="comment"&gt;
          &lt;div class="_ top"&gt;
            &lt;a class="_" href="{website}"&gt;{name}&lt;/a&gt; said
            &lt;a class="_" title="{time}"&gt;&lt;/a&gt;:
          &lt;/div&gt;
          &lt;div class="text"&gt;&lt;/div&gt;
        &lt;/div&gt;   
      &lt;/div&gt;
    &lt;/div&gt;
</code></pre>

<p>The javascript to actually execute this template looks like this:</p>

<pre><code>// The comments template will be removed from the DOM!
var template = new Template('comments-template');

// template will result in a new DOM node
var result = template.expand(data);

// insert the resulting node into the comments container
var container = document.getElementsByClassName('comments')[0];
container.appendChild(result);
</code></pre>

<p>Using jQuery the code gets a bit cleaner:</p>

<pre><code>// The comments template will be removed from the DOM!
var template = new Template('comments-template');

// Expand the template into the comments section
$('.comments').expand(template, data);
</code></pre>

<h3>Basic Rules</h3>

<p>There are 5 basic rules:</p>

<ul>
<li><p>Strings and Numbers are inserted by innerHTML to the current node.</p></li>
<li><p>Arrays repeat the current node and process its elements recursively in same scope.</p></li>
<li><p>Objects trigger a class name lookup by property name. The value of each property is expanded recursively in new scope.</p></li>
<li><p>Code will be evaluated for text surounded with braces (Works also for attributes).</p></li>
<li><p>Processing child nodes will be triggered for nodes with a class attribute starting with <code>_</code>.</p></li>
</ul>

<p>I admit the last point is a bit quirky, but processing all child nodes per default is too expensive and too unpredictable. Maybe I will find a better way, but I don’t mind inserting these extra <code>_</code> class names.</p>

<h3>Evaluation</h3>

<p>So speaking of the example data, this would mean following algorithm:</p>

<ul>
<li><p>Find the first node with a class name of comment.</p></li>
<li><p>Repeat this node two times and recursively process the first and second comment.</p></li>
<li><p>Descend into the node with class <code>top</code>.</p></li>
<li><p>Descend into the first link node.</p></li>
<li><p>Evaluate the code found in the <em>href</em> attribute and in the text.</p></li>
<li><p>Descend into the second link node.</p></li>
<li><p>Evaluate the code found in the <em>title</em> attribute.</p></li>
<li><p>Find the first node with the class <code>text</code>.</p></li>
<li><p>Insert the the text of the comment into the found node.</p></li>
</ul>

<p>Note that we are dealing with two scopes here: the global scope and the comment scope. The global scope just contains a name <em>comment</em> and the comment scope contains the names <code>date</code>, <code>name</code>, <code>website</code> and <code>text</code>.</p>

<h3>Download</h3>

<p>Download the script at my <a href="http://github.com/georgi/patroon/tree/master">github repository</a>.</p>

  <hr/>

  <div style="padding-bottom:40px">
    <script type="text/javascript">
      if (typeof window.Delicious == "undefined") window.Delicious = {};
      Delicious.BLOGBADGE_DEFAULT_CLASS = 'delicious-blogbadge-line';
    </script>
    <script src="http://static.delicious.com/js/blogbadge.js"></script>
  </div>

  <h2>Comments</h2>

  <div class="comments-loading" style="display:none">
    <img src="../../images/loading.gif"></img>
    Loading Comments...
  </div>

  <div class="comments">  
    <div id="comments-template">
      <div class="comment">
	<div class="_ top">
	  <a class="_" href="{website}">{name}</a> said
	  <a class="_" title="{time}"></a>:
	</div>
	<div class="text"></div>
      </div>
    </div>
  </div>

  <hr/>  

  <div class="comment-form-loading" style="display:none">
    <img src="../../images/loading.gif"></img>
    Posting Comment...
  </div>

  <div class="comment-form">
    <h4>Leave a comment</h4>
    <form>
      <input type="hidden" name="guid" value="dbbec5c0-6094-012b-f5dd-001a92975b89"/>
      <p>
	<label>Name</label><br/>
	<input type="text" name="name" size="40"/>
      </p>
      <p>
	<label>Website</label><br/>
	<input type="text" name="website"  size="40"/>
      </p>
      <p>
	<label>Comment (Use markdown for formatting)</label><br/>
	<textarea name="text" cols="60" rows="10"></textarea>
      </p>
      <p>
	<input type="submit" value="Post comment"/>
      </p>
    </form>
  </div>
</div>



      </div>

      <div class="right column span-5 last"> 

	<h4>Subscribe</h4>

	<p>
	  <a href="http://feeds.feedburner.com/matthias-georgi" rel="alternate" type="application/rss+xml">
	    <img src="../../images/rss.png"></img>
	    <img src="http://feeds.feedburner.com/~fc/matthias-georgi?bg=99CCFF&amp;fg=444444&amp;anim=0" height="26" width="88"/>
	  </a>
	  <br/>
	  <a href="http://www.feedburner.com/fb/a/emailverifySubmit?feedId=2408112&amp;loc=en_US">
	    or subscribe by email
	  </a>
	</p>
	  
	<h4>About</h4>

	<div class="about">
	  Matthias Georgi lives in
	  <em>Darmstadt, Germany</em> and works as a freelance
	  software developer.
	  <a href="../../about.html">read more</a>
	</div>

	<h4>Archives</h4>

	<ul>
	  
	    <li><a href="../../2007/4/index.html">April 2007</a></li> 
	  
	    <li><a href="../../2007/5/index.html">May 2007</a></li> 
	  
	    <li><a href="../../2008/9/index.html">September 2008</a></li> 
	  
	</ul>

	<h4>Recent posts</h4>

	<ul>
	  
	    <li><a href="../../2008/9/shinmun-01-gem-released.html">Shinmun-0.1 Gem Released</a></li> 
	  
	    <li><a href="../../2008/9/patroon-a-javascript-template-engine.html">Patroon - a Javascript Template Engine</a></li> 
	  
	    <li><a href="../../2008/9/commenting-system-with-lightweight-json-store.html">Commenting system with lightweight JSON store</a></li> 
	  
	    <li><a href="../../2008/9/shinmun-a-small-and-beautiful-blog-engine.html">Shinmun, a small and beautiful blog engine</a></li> 
	  
	    <li><a href="../../2008/9/emacs-completions.html">Emacs Completions with Hippie-Expand and Snippets</a></li> 
	  
	    <li><a href="../../2007/5/google-like-search-results-helper.html">Google-like Search Results Helper</a></li> 
	  
	    <li><a href="../../2007/4/dry-up-your-url-helpers.html">DRY Up Your Url Helpers</a></li> 
	  
	    <li><a href="../../2007/4/pretty-restful-urls-in-rails.html">Pretty RESTful URLs in Rails</a></li> 
	  
	    <li><a href="../../2007/4/building-delicous-and-flickr-sidebar-in-5-minutes.html">Building a del.ico.us and flickr sidebar in 5 minutes</a></li> 
	  
	    <li><a href="../../2007/4/fast-autocompletion-with-rails.html">Fast Auto-completion with Rails, Scriptaculous and JSON</a></li> 
	  
	</ul>

	<h4>Github</h4>

	<ul>
	  <li>
	    <a href="http://github.com/georgi">
	      My profile
	    </a>
	  </li>
	  <li>
	    <a href="http://github.com/georgi/shinmun/tree/master">
	      Shinmun - blog engine
	    </a>
	  </li>
	  <li>
	    <a href="http://github.com/georgi/patroon/tree/master">
	      Patroon - template engine
	    </a>
	  </li>
	</ul>

	<h4>My Projects</h4>

	<ul>
	  <li>
	    <a href="http://www.matthias-georgi.de/2008/9/shinmun-a-small-and-beautiful-blog-engine.html">
	      Shinmun - blog engine
	    </a>
	  </li>
	  <li>
	    <a href="http://www.matthias-georgi.de/2008/9/patroon-a-javascript-template-engine.html">
	      Patroon - template engine
	    </a>
	  </li>
	  <li>
	    <a href="http://www.sportubes.com">
	      Sportubes
	    </a>
	  </li>
	</ul>

	<h4>My Music</h4>

	<ul>
	  <li>
	    <a href="http://www.p-ersag.com">
	      Planet Ersag
	    </a>
	  </li>
	  <li>
	    <a href="http://www.myspace.com/planetersag">
	      Planet Ersag @ Myspace
	    </a>
	  </li>
	  <li>
	    <a href="http://www.last.fm/music/Planet+Ersag">
	      Planet Ersag @ Last.fm
	    </a>
	  </li>
	</ul>

	<h4>My Friends</h4>

	<ul>
	  <li>
	    <a href="http://www.lisafreieck.com">
	      Lisa Freieck
	    </a>
	  </li>	  
	  <li>
	    <a href="http://www.myspace.com/janvondracek">
	      Jan Vondráček
	    </a>
	  </li>
	  <li>
	    <a href="http://www.myspace.com/soultier">
	      Soultier
	    </a>
	  </li>
	  <li>
	    <a href="http://www.myspace.com/nukularium">
	      Nukular
	    </a>
	  </li>
	  <li>
	    <a href="http://www.myspace.com/bitchkanaktechno">
	      BKT
	    </a>
	  </li>

	</ul>

      </div>
    </div>

    <script type="text/javascript" src="../../javascripts/all.js?1221133113"></script>
<script type="text/javascript" src="../../javascripts/showdown.js?1205881696"></script>
<script type="text/javascript" src="../../javascripts/template.js?1220960964"></script>
<script type="text/javascript" src="../../javascripts/default.js?1220656864"></script>
<script type="text/javascript" src="../../javascripts/comments.js?1220887453"></script>
<script type="text/javascript" src="../../javascripts/wmd.js?1205881696"></script>

    
      <script type="text/javascript" src="../../javascripts/highlight.js?1220965535"></script>
      <script type="text/javascript">
	hljs.initHighlightingOnLoad('javascript','html');
      </script>
    

    <script type="text/javascript">
      var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
      document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
    </script>

    <script type="text/javascript">
      var pageTracker = _gat._getTracker("UA-927203-10");
      pageTracker._trackPageview();
    </script> 

  </body>
</html>
